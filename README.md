# CSS critic
This is an experiment in determining [critical CSS] for a given URL.
It uses [PhantomJS] to load the URL and execute [some JavaScript](get-css.js)
that:

* Extracts each of the CSS rules from all of the stylesheets on the page.
  * Stylesheets without `screen` or `all` media are skipped.
  * No other `@media` rules are filtered so that the critical CSS can apply
    to all screen sizes.
* Gets all of the elements on the page whose bounding box is above the fold,
  or has `display: none` (in which case the bounding box cannot be determined).
* Finds the intersection of the CSS rules by determining whether any of the
  "visible" elements matches any of their selectors via [Element.matches].

If you want to try it out, clone this repo then:

```sh
npm install
node test.js [url]
```

This will produce a bunch of artifacts in the working directory:

1. `critical.css`: the "critical" stylesheet.
1. `before.html` and `before.png`: the HTML source and a screenshot of the URL
   before the CSS is modified.
1. `nocss.png`: a screenshot of the URL after removing all of the CSS.
1. `after.html` and `after.png`: the HTML source and a screenshot of the URL
   after the critical CSS has been inserted into the `<head>`.
1. `diff.png`: the visual diff or `before.png` and `after.png` generated by
   [Blink-diff].
   
## See also
* [addyosmani/critical](https://github.com/addyosmani/critical)
* [filamentgroup/criticalCSS](https://github.com/filamentgroup/criticalCSS)

[critical CSS]: https://www.smashingmagazine.com/2015/08/understanding-critical-css/
[PhantomJS]: http://phantomjs.org/
[blink-diff]: http://yahoo.github.io/blink-diff/
[Element.matches]: https://developer.mozilla.org/en-US/docs/Web/API/Element/matches
